<!DOCTYPE html>
<html>
  <head>
    <title>Charts</title>
    <style>
      canvas {
        width: 90vw !important;
        height: 40vh !important;
      }
    </style>
  </head>
  <body>
    <div style="position: relative; width:90vw; padding:5vh 5vw; height: 40vh;">
      <canvas id="canvas1"></canvas>
    </div>
    <div style="position: relative; width:90vw; padding:5vh 5vw; height:40vh;">
      <canvas id="canvas2"></canvas>
    </div>
    <script src="/socket.io-1.2.0.js"></script>
    <script src="/Chart.min.js"></script>
    <script src="/util.js"></script>
    <script>
      var configVolume = {
        type: "line",
        data: {
          datasets: [
            {
              label: "Volume",
              backgroundColor: window.chartColors.red,
              data: [],
              fill: true
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          title: {
            display: true,
            text: "Volume"
          },
          animation: {
            duration: 0
          },
          hover: {
            animationDuration: 0
          },
          responsiveAnimationDuration: 0,
          elements: {
            line: {
              tension: 0 // disables bezier curves
            }
          },
          sampleSize: 3,
          minRotation: 25,
          maxRotation: 25
        }
      };
      var configPressure = {
        type: "line",
        data: {
          datasets: [
            {
              label: "Pressure",
              backgroundColor: window.chartColors.red,
              fill: true,
              data: []
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          title: {
            display: true,
            text: "Pressure"
          },
          animation: {
            duration: 0 // general animation time
          },
          hover: {
            animationDuration: 0 // duration of animations when hovering an item
          },
          responsiveAnimationDuration: 0 // animation duration after a resize
        }
      };

      window.onload = function() {
        var ctx1 = document.getElementById("canvas1").getContext("2d");
        window.volume = new Chart(ctx1, configVolume);
        var ctx2 = document.getElementById("canvas2").getContext("2d");
        window.pressure = new Chart(ctx2, configPressure);
        var socket = io();
        var i = 0;
        socket.on("data", function(msg) {
          configVolume.data.datasets[0].data[i] = msg.volume;
          configVolume.data.datasets[0].data[i + 1] = null;
          configVolume.data.datasets[0].data[i + 2] = null;
          configVolume.data.labels[i] = i;
          configPressure.data.datasets[0].data[i] = msg.pressure;
          configPressure.data.datasets[0].data[i + 1] = null;
          configPressure.data.datasets[0].data[i + 2] = null;
          configPressure.data.labels[i] = i;
          i++;
          if (i > 200) {
            i = 0;
          }
          window.volume.update();
          window.pressure.update();
        });
      };
    </script>
  </body>
</html>
